{% extends 'base.html.twig' %}

{% block title %}Interventions{% endblock %}

{% block body %}
<div class="container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Interventions</h1>
        <a href="{{ path('intervention_new') }}" class="btn btn-primary">
            Ajouter une nouvelle intervention
        </a>
    </div>

    {# ===================== Filtres ======= #}
    <form method="get" class="row g-3 mb-4">

        <div class="col-md-3">
            <label>Date de début</label>
            <input 
                type="datetime-local" 
                name="start" 
                class="form-control"
                value="{{ app.request.get('start') }}"
            >
        </div>

        <div class="col-md-3">
            <label>Date de fin</label>
            <input 
                type="datetime-local" 
                name="end" 
                class="form-control"
                value="{{ app.request.get('end') }}"
            >
        </div>

        <div class="col-md-3">
            <label>Module</label>
            <select name="module" class="form-select">
                <option value="">Tous les modules</option>
                {% for module in modules %}
                    <option 
                        value="{{ module.id }}"
                        {% if app.request.get('module') == module.id %}selected{% endif %}
                    >
                        {{ module.nom }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-warning w-100">
                Filtrer
            </button>
        </div>

    </form>

    <p><strong>{{ interventions|length }}</strong> interventions trouvées</p>

    {# === Tableau ===================== #}
    <div class="table-responsive">
        <table class="table table-hover align-middle">

            <thead class="table-light">
                <tr>
                    <th>Date de l’intervention</th>
                    <th>Module & titre</th>
                    <th>Type</th>
                    <th>Intervenants</th>
                    <th>Visio</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                {% for intervention in interventions %}
                    <tr>
                        <td>
                            {{ intervention.dateDebut|date('d/m/Y H:i') }}
                            →
                            {{ intervention.dateFin|date('d/m/Y H:i') }}
                        </td>

                        <td>
                            <strong>{{ intervention.module.nom }}</strong><br>
                            <small class="text-muted">{{ intervention.titre }}</small>
                        </td>

                        <td>
                            {{ intervention.typeIntervention.nom }}
                        </td>

                        <td>
                            {% for intervenant in intervention.corpsEnseignants %}
                                {{ intervenant.nom }} {{ intervenant.prenom }}{% if not loop.last %}, {% endif %}
                            {% else %}
                                <em>Aucun</em>
                            {% endfor %}
                        </td>

                        <td class="text-center">
                            {% if intervention.visio %}
                                <img src="{{ asset('media/icons/camera.png') }}" alt="camera" style="width: 20px; height: auto; margin-right: 10px;">
                            {% else %}
                                <img src="{{ asset('media/icons/camerabarre.png') }}" alt="camerabarre" style="width: 20px; height: auto; margin-right: 10px;">
                            {% endif %} 
                        </td>

                        <td class="text-end">
                            <a 
                                href="{{ path('intervention_edit', {id: intervention.id}) }}"
                                class="btn btn-sm btn-outline-primary"
                            >
                                Accéder à la fiche
                            </a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            Aucune intervention trouvée
                        </td>
                    </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

    {# ============ Pagination ===================== #}
    {% if pages > 1 %}
        <nav class="d-flex justify-content-center mt-4">
            <ul class="pagination">

                {% for p in 1..pages %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a 
                            class="page-link"
                            href="{{ path('interventions_list', app.request.query.all | merge({page: p})) }}"
                        >
                            {{ p }}
                        </a>
                    </li>
                {% endfor %}

            </ul>
        </nav>
    {% endif %}

</div>
{% endblock %}
